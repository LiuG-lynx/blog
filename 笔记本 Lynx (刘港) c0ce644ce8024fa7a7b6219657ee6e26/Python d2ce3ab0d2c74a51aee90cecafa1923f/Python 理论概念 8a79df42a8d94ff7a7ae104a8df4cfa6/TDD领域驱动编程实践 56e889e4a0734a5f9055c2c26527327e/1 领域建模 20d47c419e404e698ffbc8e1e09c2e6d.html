<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>1. é¢†åŸŸå»ºæ¨¡</title><style>
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, YuMincho, "Yu Mincho", "Hiragino Mincho ProN", "Hiragino Mincho Pro", "Songti TC", "Songti SC", "SimSun", "Nanum Myeongjo", NanumMyeongjo, Batang, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC', 'Noto Sans CJK KR'; }

.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC', 'Noto Sans Mono CJK KR'; }

.highlight-default {
}
.highlight-gray {
	color: rgb(155,154,151);
}
.highlight-brown {
	color: rgb(100,71,58);
}
.highlight-orange {
	color: rgb(217,115,13);
}
.highlight-yellow {
	color: rgb(223,171,1);
}
.highlight-teal {
	color: rgb(15,123,108);
}
.highlight-blue {
	color: rgb(11,110,153);
}
.highlight-purple {
	color: rgb(105,64,165);
}
.highlight-pink {
	color: rgb(173,26,114);
}
.highlight-red {
	color: rgb(224,62,62);
}
.highlight-gray_background {
	background: rgb(235,236,237);
}
.highlight-brown_background {
	background: rgb(233,229,227);
}
.highlight-orange_background {
	background: rgb(250,235,221);
}
.highlight-yellow_background {
	background: rgb(251,243,219);
}
.highlight-teal_background {
	background: rgb(221,237,234);
}
.highlight-blue_background {
	background: rgb(221,235,241);
}
.highlight-purple_background {
	background: rgb(234,228,242);
}
.highlight-pink_background {
	background: rgb(244,223,235);
}
.highlight-red_background {
	background: rgb(251,228,228);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(55, 53, 47, 0.6);
	fill: rgba(55, 53, 47, 0.6);
}
.block-color-brown {
	color: rgb(100,71,58);
	fill: rgb(100,71,58);
}
.block-color-orange {
	color: rgb(217,115,13);
	fill: rgb(217,115,13);
}
.block-color-yellow {
	color: rgb(223,171,1);
	fill: rgb(223,171,1);
}
.block-color-teal {
	color: rgb(15,123,108);
	fill: rgb(15,123,108);
}
.block-color-blue {
	color: rgb(11,110,153);
	fill: rgb(11,110,153);
}
.block-color-purple {
	color: rgb(105,64,165);
	fill: rgb(105,64,165);
}
.block-color-pink {
	color: rgb(173,26,114);
	fill: rgb(173,26,114);
}
.block-color-red {
	color: rgb(224,62,62);
	fill: rgb(224,62,62);
}
.block-color-gray_background {
	background: rgb(235,236,237);
}
.block-color-brown_background {
	background: rgb(233,229,227);
}
.block-color-orange_background {
	background: rgb(250,235,221);
}
.block-color-yellow_background {
	background: rgb(251,243,219);
}
.block-color-teal_background {
	background: rgb(221,237,234);
}
.block-color-blue_background {
	background: rgb(221,235,241);
}
.block-color-purple_background {
	background: rgb(234,228,242);
}
.block-color-pink_background {
	background: rgb(244,223,235);
}
.block-color-red_background {
	background: rgb(251,228,228);
}
.select-value-color-default { background-color: rgba(206,205,202,0.5); }
.select-value-color-gray { background-color: rgba(155,154,151, 0.4); }
.select-value-color-brown { background-color: rgba(140,46,0,0.2); }
.select-value-color-orange { background-color: rgba(245,93,0,0.2); }
.select-value-color-yellow { background-color: rgba(233,168,0,0.2); }
.select-value-color-green { background-color: rgba(0,135,107,0.2); }
.select-value-color-blue { background-color: rgba(0,120,223,0.2); }
.select-value-color-purple { background-color: rgba(103,36,222,0.2); }
.select-value-color-pink { background-color: rgba(221,0,129,0.2); }
.select-value-color-red { background-color: rgba(255,0,26,0.2); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="20d47c41-9e40-4e69-8ffb-c8e1e09c2e6d" class="page sans"><header><img class="page-cover-image" src="https://www.notion.so/images/page-cover/met_paul_signac.jpg" style="object-position:center 30.000000000000004%"/><div class="page-header-icon page-header-icon-with-cover"><span class="icon">ğŸ›</span></div><h1 class="page-title">1. é¢†åŸŸå»ºæ¨¡</h1></header><div class="page-body"><p id="547db00b-863c-4426-849e-a5c7cf2864d8" class="">TDD é¢†åŸŸé©±åŠ¨ç¼–ç¨‹  </p><h2 id="99657c27-821d-4554-8820-07b8feab5357" class="">éœ€æ±‚</h2><p id="c5432ceb-45f5-453c-8510-daaab41081f4" class="">å®¢æˆ·å¹¶ä¸å…³å¿ƒæ•°æ®æ¨¡å‹,ä»–ä»¬åªå…³å¿ƒç³»ç»Ÿçš„å·¥ä½œ</p><p id="a0e59d35-0845-492a-b5cd-f2b7e50f5a7e" class="">
</p><h2 id="01975796-98a6-49b8-a84c-2d33246eb8dd" class="">è®¨è®º</h2><p id="50c7f395-758e-4905-aaaa-4cbebb6a8b80" class="">å¦‚ä½•é€šè¿‡TDD æ–¹å¼æ„å»ºå¯Œå¯¹è±¡æ¨¡å‹, å¦‚ä½•æ„å»ºä¸æŒä¹…åŒ–æ— å…³çš„ä»£ç , å¦‚ä½•åœ¨é¢†åŸŸå‘¨å›´åˆ›å»ºç¨³å®šçš„APIä»¥ä¾¿ç§¯æé‡æ„</p><h2 id="66399428-558b-4275-ac30-1cf2267e126f" class="">æ¶‰åŠçš„ ç›¸å…³æ¶‰åŠæ¨¡å¼</h2><ul id="3988e477-c6f7-4064-81d5-e7a611c0df51" class="bulleted-list"><li>ä»“åº“æ¨¡å¼   å¯¹æŒä¹…åŒ–å­˜å‚¨çš„æŠ½è±¡</li></ul><ul id="76b4fe7a-31fc-417d-a5ae-729118eb12e2" class="bulleted-list"><li>æœåŠ¡å±‚ å®šä¹‰æˆ‘ä»¬ä¸šåŠ¡é€»è¾‘å¼€å§‹å’Œç»“æŸçš„ä½ç½®</li></ul><ul id="c8b198a1-fb03-4791-84b0-33a1cc730fbd" class="bulleted-list"><li>å·¥ä½œå•å…ƒæ¨¡å¼ æä¾›åŸå­æ“ä½œçš„æŠ½è±¡</li></ul><ul id="1e5d601b-8e05-4d23-a74a-2a58c4084899" class="bulleted-list"><li>èšåˆæ¨¡å¼ ä¿è¯æ•°æ®å®Œæ•´æ€§</li></ul><p id="fdc3b2c4-0e5c-439c-9c38-4456b20644fa" class="">
</p><figure id="11bcbe29-a7e2-425a-8a71-107341be7d96" class="image"><a href="1%20%E9%A2%86%E5%9F%9F%E5%BB%BA%E6%A8%A1%2020d47c419e404e698ffbc8e1e09c2e6d/Untitled.png"><img style="width:452px" src="1%20%E9%A2%86%E5%9F%9F%E5%BB%BA%E6%A8%A1%2020d47c419e404e698ffbc8e1e09c2e6d/Untitled.png"/></a></figure><h3 id="1d8ba0e9-3cf7-4efb-bf9f-59e23db14d75" class="">é¢†åŸŸå»ºæ¨¡å…³é”®æ¨¡å¼</h3><ol id="e514224e-a59c-4ef0-9f24-96f34efbf109" class="numbered-list" start="1"><li>å®ä½“ Entity</li></ol><ol id="cdd70016-74a7-4d76-9d1e-298a52b852be" class="numbered-list" start="2"><li>å€¼å¯¹è±¡ Value Object</li></ol><ol id="0e4b8cac-518c-4bab-a32c-0b0f637cfe63" class="numbered-list" start="3"><li>é¢†åŸŸæœåŠ¡ Domain Service</li></ol><p id="71bbfdea-d418-411b-9cbc-0abf9af4570d" class="">
</p><h3 id="3ee411b0-30c6-4b84-892d-6b65264b7f38" class="">é¢†åŸŸæ¨¡å‹ Domain Model</h3><p id="ceeb5fcb-8aa8-4b65-95ed-ec6e621dc128" class="">Domain æ˜¯ä½ è¯•å›¾è§£å†³æŸäº›é—®é¢˜çš„ä¸€ç§è¯´æ³•,ä¸€ç»„æ´»åŠ¨</p><p id="97c36f3a-1a86-4305-a322-3b597fd0ff64" class="">Model æ˜¯ä¸€ä¸ªè¿‡ç¨‹æˆ–ç°è±¡çš„æ˜ å°„ ä¸šåŠ¡åœ°å›¾, å¯¹å¤æ‚é—®é¢˜çš„ä¸€ç§æ€è€ƒæ–¹å¼</p><p id="b0c1000e-2443-4db8-bba6-bab02d15a712" class="">
</p><h3 id="9aad5c24-fba1-42c7-b06a-3165cd9664ff" class="">æ·±å…¥é¢†åŸŸè¯­è¨€</h3><div id="aa21a5a9-acd7-4034-94c5-e762b4c0a4b2" class="collection-content"><h4 class="collection-title">ä¸šåŠ¡ç›¸ä¿¡æ³¨é‡Š</h4><table class="collection-content"><thead><tr><th><span class="icon property-icon"><svg viewBox="0 0 14 14" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.4);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesTitle"><path d="M7.73943662,8.6971831 C7.77640845,8.7834507 7.81338028,8.8943662 7.81338028,9.00528169 C7.81338028,9.49823944 7.40669014,9.89260563 6.91373239,9.89260563 C6.53169014,9.89260563 6.19894366,9.64612676 6.08802817,9.30105634 L5.75528169,8.33978873 L2.05809859,8.33978873 L1.72535211,9.30105634 C1.61443662,9.64612676 1.2693662,9.89260563 0.887323944,9.89260563 C0.394366197,9.89260563 0,9.49823944 0,9.00528169 C0,8.8943662 0.0246478873,8.7834507 0.0616197183,8.6971831 L2.46478873,2.48591549 C2.68661972,1.90669014 3.24119718,1.5 3.90669014,1.5 C4.55985915,1.5 5.12676056,1.90669014 5.34859155,2.48591549 L7.73943662,8.6971831 Z M2.60035211,6.82394366 L5.21302817,6.82394366 L3.90669014,3.10211268 L2.60035211,6.82394366 Z M11.3996479,3.70598592 C12.7552817,3.70598592 14,4.24823944 14,5.96126761 L14,9.07922535 C14,9.52288732 13.6549296,9.89260563 13.2112676,9.89260563 C12.8169014,9.89260563 12.471831,9.59683099 12.4225352,9.19014085 C12.028169,9.6584507 11.3257042,9.95422535 10.5492958,9.95422535 C9.60035211,9.95422535 8.47887324,9.31338028 8.47887324,7.98239437 C8.47887324,6.58978873 9.60035211,6.08450704 10.5492958,6.08450704 C11.3380282,6.08450704 12.040493,6.33098592 12.4348592,6.81161972 L12.4348592,5.98591549 C12.4348592,5.38204225 11.9172535,4.98767606 11.1285211,4.98767606 C10.6602113,4.98767606 10.2411972,5.11091549 9.80985915,5.38204225 C9.72359155,5.43133803 9.61267606,5.46830986 9.50176056,5.46830986 C9.18133803,5.46830986 8.91021127,5.1971831 8.91021127,4.86443662 C8.91021127,4.64260563 9.0334507,4.44542254 9.19366197,4.34683099 C9.87147887,3.90316901 10.6232394,3.70598592 11.3996479,3.70598592 Z M11.1778169,8.8943662 C11.6830986,8.8943662 12.1760563,8.72183099 12.4348592,8.37676056 L12.4348592,7.63732394 C12.1760563,7.29225352 11.6830986,7.11971831 11.1778169,7.11971831 C10.5616197,7.11971831 10.056338,7.45246479 10.056338,8.0193662 C10.056338,8.57394366 10.5616197,8.8943662 11.1778169,8.8943662 Z M0.65625,11.125 L13.34375,11.125 C13.7061869,11.125 14,11.4188131 14,11.78125 C14,12.1436869 13.7061869,12.4375 13.34375,12.4375 L0.65625,12.4375 C0.293813133,12.4375 4.43857149e-17,12.1436869 0,11.78125 C-4.43857149e-17,11.4188131 0.293813133,11.125 0.65625,11.125 Z"></path></svg></span>è¯´æ˜ 1</th><th><span class="icon property-icon"><svg viewBox="0 0 14 14" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.4);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesText"><path d="M7,4.56818 C7,4.29204 6.77614,4.06818 6.5,4.06818 L0.5,4.06818 C0.223858,4.06818 0,4.29204 0,4.56818 L0,5.61364 C0,5.88978 0.223858,6.11364 0.5,6.11364 L6.5,6.11364 C6.77614,6.11364 7,5.88978 7,5.61364 L7,4.56818 Z M0.5,1 C0.223858,1 0,1.223858 0,1.5 L0,2.54545 C0,2.8216 0.223858,3.04545 0.5,3.04545 L12.5,3.04545 C12.7761,3.04545 13,2.8216 13,2.54545 L13,1.5 C13,1.223858 12.7761,1 12.5,1 L0.5,1 Z M0,8.68182 C0,8.95796 0.223858,9.18182 0.5,9.18182 L11.5,9.18182 C11.7761,9.18182 12,8.95796 12,8.68182 L12,7.63636 C12,7.36022 11.7761,7.13636 11.5,7.13636 L0.5,7.13636 C0.223858,7.13636 0,7.36022 0,7.63636 L0,8.68182 Z M0,11.75 C0,12.0261 0.223858,12.25 0.5,12.25 L9.5,12.25 C9.77614,12.25 10,12.0261 10,11.75 L10,10.70455 C10,10.4284 9.77614,10.20455 9.5,10.20455 L0.5,10.20455 C0.223858,10.20455 0,10.4284 0,10.70455 L0,11.75 Z"></path></svg></span>è¯´æ˜</th></tr></thead><tbody><tr id="249ca863-3e31-4d4d-b03b-f155ac0a2bf5"><td class="cell-title"><a href="1%20%E9%A2%86%E5%9F%9F%E5%BB%BA%E6%A8%A1%2020d47c419e404e698ffbc8e1e09c2e6d/%E4%B8%9A%E5%8A%A1%E7%9B%B8%E4%BF%A1%E6%B3%A8%E9%87%8A%20aa21a5a9acd7403494c5e762b4c0a4b2/%E4%BA%A7%E5%93%81%E7%94%B1SKU%E8%BF%9B%E8%A1%8C%E6%A0%87%E8%AF%86%20249ca8633e314d4db03bf155ac0a2bf5.html">äº§å“ç”±SKUè¿›è¡Œæ ‡è¯†</a></td><td class="cell-YTBm"></td></tr><tr id="e8b522fc-bad9-41be-a70f-98203d3f2414"><td class="cell-title"><a href="1%20%E9%A2%86%E5%9F%9F%E5%BB%BA%E6%A8%A1%2020d47c419e404e698ffbc8e1e09c2e6d/%E4%B8%9A%E5%8A%A1%E7%9B%B8%E4%BF%A1%E6%B3%A8%E9%87%8A%20aa21a5a9acd7403494c5e762b4c0a4b2/%E9%A1%BE%E5%AE%A2%E4%B8%8B%E8%AE%A2%E5%8D%95%E3%80%82%E8%AE%A2%E5%8D%95%E7%94%B1%E8%AE%A2%E5%8D%95ID%E5%BC%95%E7%94%A8%E6%A0%87%E8%AF%86%EF%BC%8C%E5%B9%B6%E7%94%B1%E5%A4%9A%E4%B8%AA%E8%AE%A2%E5%8D%95%E8%A1%8C%E7%BB%84%E6%88%90%EF%BC%8C%E5%85%B6%E4%B8%AD%E6%AF%8F%E8%A1%8C%E6%9C%89%E4%B8%80%E4%B8%AASKU%E5%92%8C%E4%B8%80%E4%B8%AA%E6%95%B0%E9%87%8F%20e8b522fcbad941bea70f98203d3f2414.html">é¡¾å®¢ä¸‹è®¢å•ã€‚è®¢å•ç”±è®¢å•IDå¼•ç”¨æ ‡è¯†ï¼Œå¹¶ç”±å¤šä¸ªè®¢å•è¡Œç»„æˆï¼Œå…¶ä¸­æ¯è¡Œæœ‰ä¸€ä¸ªSKUå’Œä¸€ä¸ªæ•°é‡</a></td><td class="cell-YTBm">- 10 ä¸ªçº¢è‰²å’–å•¡æ¡Œ</td></tr><tr id="7042370c-d486-446f-bb8e-dd1bb67d21e8"><td class="cell-title"><a href="1%20%E9%A2%86%E5%9F%9F%E5%BB%BA%E6%A8%A1%2020d47c419e404e698ffbc8e1e09c2e6d/%E4%B8%9A%E5%8A%A1%E7%9B%B8%E4%BF%A1%E6%B3%A8%E9%87%8A%20aa21a5a9acd7403494c5e762b4c0a4b2/%E9%87%87%E8%B4%AD%E9%83%A8%E9%97%A8%E9%87%87%E8%B4%AD%E4%B8%80%E6%89%B9%E4%BA%A7%E5%93%81%EF%BC%8C%E6%AF%8F%E4%B8%80%E6%89%B9%E6%9C%89%E4%B8%80%E4%B8%AA%E5%94%AF%E4%B8%80%E7%9A%84ID,%20SKU%20%E5%92%8C%20%E6%95%B0%E9%87%8F%EF%BC%8C%E7%A7%B0%E4%B9%8B%E4%B8%BA%E9%87%87%E8%B4%AD%E6%89%B9%E6%AC%A1%EF%BC%8C%E9%87%87%E8%B4%AD%E6%89%B9%E6%AC%A1%E5%8F%AF%E5%88%86%E4%B8%BA%E5%B7%B2%E7%BB%8F%207042370cd486446fbb8edd1bb67d21e8.html">é‡‡è´­éƒ¨é—¨é‡‡è´­ä¸€æ‰¹äº§å“ï¼Œæ¯ä¸€æ‰¹æœ‰ä¸€ä¸ªå”¯ä¸€çš„ID, SKU å’Œ æ•°é‡ï¼Œç§°ä¹‹ä¸ºé‡‡è´­æ‰¹æ¬¡ï¼Œé‡‡è´­æ‰¹æ¬¡å¯åˆ†ä¸ºå·²ç»åœ¨ä»“åº“ä¸­ï¼Œå’Œæ­£åœ¨è¿è¾“ä¸­çš„</a></td><td class="cell-YTBm"></td></tr><tr id="f5c97e6d-ce6d-4056-99ed-c70fa882534d"><td class="cell-title"><a href="1%20%E9%A2%86%E5%9F%9F%E5%BB%BA%E6%A8%A1%2020d47c419e404e698ffbc8e1e09c2e6d/%E4%B8%9A%E5%8A%A1%E7%9B%B8%E4%BF%A1%E6%B3%A8%E9%87%8A%20aa21a5a9acd7403494c5e762b4c0a4b2/%E9%87%87%E8%B4%AD%E9%83%A8%E9%97%A8%E9%87%87%E8%B4%AD%E4%B8%80%E6%89%B9%E4%BA%A7%E5%93%81,%20%E6%AF%8F%E4%B8%80%E6%89%B9%E9%83%BD%E6%9C%89%E4%B8%80%E4%B8%AA%E5%94%AF%E4%B8%80ID,SKU%E5%92%8C%E6%95%B0%E9%87%8F,%E7%A7%B0%E4%B9%8B%E4%B8%BA%E9%87%87%E8%B4%AD%E6%89%B9%E6%AC%A1,%E9%87%87%E8%B4%AD%E6%89%B9%E6%AC%A1%E5%8F%AF%E5%88%86%E4%B8%BA%E5%9C%A8%E4%BB%93%E5%BA%93%E5%92%8C%20f5c97e6dce6d405699edc70fa882534d.html">é‡‡è´­éƒ¨é—¨é‡‡è´­ä¸€æ‰¹äº§å“, æ¯ä¸€æ‰¹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€ID,SKUå’Œæ•°é‡,ç§°ä¹‹ä¸ºé‡‡è´­æ‰¹æ¬¡,é‡‡è´­æ‰¹æ¬¡å¯åˆ†ä¸ºåœ¨ä»“åº“å’Œæ­£åœ¨è¿è¾“ä¸­</a></td><td class="cell-YTBm"></td></tr><tr id="d29ea603-c4b4-4a4b-925c-5456f2e22552"><td class="cell-title"><a href="1%20%E9%A2%86%E5%9F%9F%E5%BB%BA%E6%A8%A1%2020d47c419e404e698ffbc8e1e09c2e6d/%E4%B8%9A%E5%8A%A1%E7%9B%B8%E4%BF%A1%E6%B3%A8%E9%87%8A%20aa21a5a9acd7403494c5e762b4c0a4b2/%E6%AF%8F%E4%B8%AA%E8%AE%A2%E5%8D%95%E4%B8%8D%E8%83%BD%E5%88%86%E9%85%8D%E4%B8%A4%E6%AC%A1%E7%BB%99%E9%87%87%E8%B4%AD%E6%89%B9%E6%AC%A1%20d29ea603c4b44a4b925c5456f2e22552.html">æ¯ä¸ªè®¢å•ä¸èƒ½åˆ†é…ä¸¤æ¬¡ç»™é‡‡è´­æ‰¹æ¬¡</a></td><td class="cell-YTBm"></td></tr><tr id="4e58c4ae-7d3e-4360-82b7-31951d7a0652"><td class="cell-title"><a href="1%20%E9%A2%86%E5%9F%9F%E5%BB%BA%E6%A8%A1%2020d47c419e404e698ffbc8e1e09c2e6d/%E4%B8%9A%E5%8A%A1%E7%9B%B8%E4%BF%A1%E6%B3%A8%E9%87%8A%20aa21a5a9acd7403494c5e762b4c0a4b2/%E9%87%87%E8%B4%AD%E6%89%B9%E6%AC%A1%E6%9C%89%E4%B8%80%E4%B8%AA%E5%8F%ABETA%E7%9A%84%E6%97%B6%E9%97%B4%EF%BC%8C%E4%BB%96%E8%A1%A8%E7%A4%BA%E5%88%B0%E8%BE%BE%E4%BB%93%E5%BA%93%E7%9A%84%E6%97%B6%E9%97%B4%204e58c4ae7d3e436082b731951d7a0652.html">é‡‡è´­æ‰¹æ¬¡æœ‰ä¸€ä¸ªå«ETAçš„æ—¶é—´ï¼Œä»–è¡¨ç¤ºåˆ°è¾¾ä»“åº“çš„æ—¶é—´</a></td><td class="cell-YTBm"></td></tr><tr id="4fe1151c-731b-4a2b-9ed3-4665177a5241"><td class="cell-title"><a href="1%20%E9%A2%86%E5%9F%9F%E5%BB%BA%E6%A8%A1%2020d47c419e404e698ffbc8e1e09c2e6d/%E4%B8%9A%E5%8A%A1%E7%9B%B8%E4%BF%A1%E6%B3%A8%E9%87%8A%20aa21a5a9acd7403494c5e762b4c0a4b2/%E6%88%91%E4%BB%AC%E8%A6%81%E4%BC%98%E5%85%88%E6%B6%88%E8%80%97%E5%BA%93%E5%AD%98%E8%80%8C%E4%B8%8D%E6%98%AF%E9%87%87%E8%B4%AD%E6%89%B9%E6%AC%A1%204fe1151c731b4a2b9ed34665177a5241.html">æˆ‘ä»¬è¦ä¼˜å…ˆæ¶ˆè€—åº“å­˜è€Œä¸æ˜¯é‡‡è´­æ‰¹æ¬¡</a></td><td class="cell-YTBm"></td></tr><tr id="4b51dc37-e62e-41de-b47c-4fc832631c68"><td class="cell-title"><a href="1%20%E9%A2%86%E5%9F%9F%E5%BB%BA%E6%A8%A1%2020d47c419e404e698ffbc8e1e09c2e6d/%E4%B8%9A%E5%8A%A1%E7%9B%B8%E4%BF%A1%E6%B3%A8%E9%87%8A%20aa21a5a9acd7403494c5e762b4c0a4b2/%E6%88%91%E4%BB%AC%E8%A6%81%E6%8C%89%E7%85%A7ETA%E6%9C%80%E6%97%A9%E5%88%B0%E8%BE%BE%E9%A1%BA%E5%BA%8F%E6%9D%A5%E5%88%86%E9%85%8D%E8%AE%A2%E5%8D%95%204b51dc37e62e41deb47c4fc832631c68.html">æˆ‘ä»¬è¦æŒ‰ç…§ETAæœ€æ—©åˆ°è¾¾é¡ºåºæ¥åˆ†é…è®¢å•</a></td><td class="cell-YTBm"></td></tr></tbody></table></div><p id="dac8d0a0-6bcc-4d3d-a8ee-0ae6dc55f4f9" class="">
</p><h3 id="9a048934-930c-425d-825a-24b76cd410fc" class="">å¯¹é¢†åŸŸæ¨¡å‹è¿›è¡Œå•å…ƒæµ‹è¯•</h3><p id="8331053b-85e9-4885-9359-aeacaa58e034" class="">è¿™é‡Œä½¿ç”¨äº†TDDçš„æ¨¡å¼è¿›è¡Œå¼€å‘ï¼Œå½“ç„¶ï¼Œæˆ‘è¿™é‡Œå¹¶ä¸æƒ³è¯´æ˜å¦‚ä½•ä½¿ç”¨TDDå¼€å‘ï¼Œä½†æ˜¯æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œå¦‚ä½•ä»éœ€æ±‚å‡ºå‘æ¥æ„å»ºä¸€ä¸ªé¢†åŸŸæ¨¡å‹</p><p id="8ea51697-3bbe-4833-a0a3-120ba8bed633" class="">Example 1. ç¬¬ä¸€ä¸ªåˆ†é…è®¢å•çš„æµ‹è¯•</p><pre id="ac61c835-c35d-4050-9e94-244b6e6051d3" class="code"><code>def test_allocating_to_batch_reduces_the_available_quantity():
    batch = Batch(&quot;batch-001&quot;, &quot;æ¡Œå­&quot;, qty=20, eta=date.today())
    line = OrderLine(&quot;order-ref&quot;, &quot;æ¡Œå­&quot;, 2)
    batch.allocate(line)
    assert batch.available_quantity == 18</code></pre><p id="78cf1033-75bf-4538-94ad-982109b0a7ea" class="">å•å…ƒæµ‹è¯•çš„åç§°æè¿°äº†æˆ‘ä»¬å¸Œæœ›ä»ç³»ç»Ÿä¸­çœ‹åˆ°çš„è¡Œä¸ºï¼Œæˆ‘ä»¬ä½¿ç”¨ç±»å’Œå˜é‡çš„åç§°å–è‡ªä¸šåŠ¡æœ¯è¯­ã€‚æˆ‘ä»¬å¯ä»¥å‘éæŠ€æœ¯åŒäº‹å±•ç¤ºè¿™æ®µä»£ç ã€‚è®©ä»–ä»¬è®¤å¯è¿™æ­£ç¡®è¡¨è¾¾äº†ç³»ç»Ÿçš„è¡Œä¸ºã€‚</p><p id="3b29ecc6-6758-42be-930c-05020bc71b1a" class="">ä¸‹é¢æˆ‘ä»¬å†™ä¸€ä¸ªç¬¦åˆæˆ‘ä»¬éœ€æ±‚çš„é¢†åŸŸæ¨¡å‹</p><p id="ba06c069-c6ac-4166-862e-72749244a55d" class="">Example 2. ç¬¬ä¸€ä¸ªé‡‡è´­æ‰¹æ¬¡çš„æ¨¡å‹</p><pre id="47043a94-2845-43cd-9dcf-338cb816a0b3" class="code"><code>@dataclass(frozen=True) #(1)(2)
class OrderLine:
    orderid: str
    sku: str
    qty: int
    
class Batch:
    def __init__(
        self, ref: str, sku: str, qty: int, eta: Optional[date] #(2)
    ):
    self.reference = ref
    self.sku = sku
    self.eta = eta
    self.available_quantity = qty
    
    def allocate(self, line: OrderLine):
        self.available_quantity -= line.qty #(3)</code></pre><p id="82b14e1e-12a4-4e4e-86cf-8a69a293abb5" class="">æ¥ä¸‹æ¥æˆ‘åšä¸€äº›è§£é‡Š</p><ol id="4fdcef2d-34f5-45ff-a25b-18844cd47691" class="numbered-list" start="1"><li><code>OrderLine</code>æ˜¯ä¸€ä¸ªä¸å¯å˜æ•°æ®ï¼Œå®ƒå¹¶æ²¡æœ‰è¡Œä¸º</li></ol><ol id="e8383a9c-f375-4353-b027-5b677c159ddf" class="numbered-list" start="2"><li>æˆ‘ä»¬æ²¡æœ‰ç”¨å¯¼å…¥æ¥åŒºåˆ«æ¨¡å‹ï¼Œä¸ºäº†æ›´æ–¹ä¾¿é˜…è¯»</li></ol><ol id="a7f51a9f-a34c-4169-8d49-85abf56ffdbd" class="numbered-list" start="3"><li>è™½ç„¶Typehinté¥±å—äº‰è®®ï¼Œä½†æ˜¯ä»–ç»™IDEæä¾›å¤§é‡æç¤ºï¼Œè€Œä¸”å¯¹äºæ¨¡å‹è€Œè¨€ï¼Œä»–é˜è¿°äº†æ¨¡å‹æœ¬èº«å¯¹å…¥å‚çš„æœŸæœ›ï¼Œè¿™å°†åœ¨åé¢çš„å¼€å‘ä¸­è·å¾—éå¸¸å¤šçš„å¥½å¤„ã€‚</li></ol><p id="0bdde942-2f91-406e-94cf-2e82b5ff2563" class="">åœ¨è¿™ä¸ªæ¨¡å‹ä¸­æˆ‘ä»¬å®ç°çš„éå¸¸ç®€å•ï¼šä¸€ä¸ª<code>Batch</code>åªåŒ…è£…ä¸€ä¸ªæ•´æ•°å¯ç”¨é‡ï¼Œæˆ‘ä»¬åœ¨åˆ†é…æ—¶é€’å‡è¯¥å€¼ã€‚è™½ç„¶æˆ‘ä»¬å†™äº†ç›¸å½“å¤šçš„ä»£ç ï¼Œåªæ˜¯ä¸ºäº†ä»ä¸€ä¸ªæ•°å­—å‡å»å¦ä¸€ä¸ªæ•°å­—ã€‚ä½†æ˜¯æˆ‘è®¤ä¸ºå¯¹æˆ‘ä»¬é¢†åŸŸè¿›è¡Œç²¾ç¡®å»ºæ¨¡ï¼Œè¿™ç‚¹ä»£ä»·æ¥è¯´æ˜¯å€¼å¾—çš„ã€‚</p><p id="c9043245-fcaf-4c14-962f-90241b89cabc" class="">OK,è®©æˆ‘ä»¬ç¼–å†™ä¸€äº›å¤±è´¥çš„æµ‹è¯•</p><p id="7f53d2ed-efd8-4c5e-a2d1-eb883c7c52b0" class="">Example 3. æµ‹è¯•æˆ‘ä»¬è®¢å•æ˜¯å¦å¯ä»¥åˆ†é…é‡‡è´­æ‰¹æ¬¡çš„é€»è¾‘</p><pre id="f1087f6f-984d-430b-b62c-5c7aa23dc91a" class="code"><code>def make_batch_and_line(sku, batch_qty, line_qty):
    return (
        Batch(&quot;batch-001&quot;, sku, batch_qty, eta=date.today()),
        OrderLine(&quot;order-123&quot;, sku, line_qty)
    )
def test_can_allocate_if_available_greater_than_required():
    large_batch, small_line = make_batch_and_line(&quot;ELEGANT-LAMP&quot;, 20, 2)
    assert large_batch.can_allocate(small_line)
    
def test_cannot_allocate_if_available_smaller_than_required():
    small_batch, large_line = make_batch_and_line(&quot;ELEGANT-LAMP&quot;, 2, 20)
    assert small_batch.can_allocate(large_line) is False
    
def test_can_allocate_if_available_equal_to_required():
    batch, line = make_batch_and_line(&quot;ELEGANT-LAMP&quot;, 2, 2)
    assert batch.can_allocate(line)
    
def test_cannot_allocate_if_skus_do_not_match():
    batch = Batch(&quot;batch-001&quot;, &quot;UNCOMFORTABLE-CHAIR&quot;, 100, eta=None)
    different_sku_line = OrderLine(&quot;order-123&quot;, &quot;EXPENSIVE-TOASTER&quot;, 10)
    assert batch.can_allocate(different_sku_line) is False</code></pre><p id="30c24b58-a9cc-4ae2-a280-f8b0ec8e438b" class="">æˆ‘ä»¬ä¸ºä¸€ä¸ªæ–°æ–¹æ³•åˆ†é…äº†å››ä¸ªç®€å•çš„æµ‹è¯•æ¥æµ‹è¯•é‡‡è´­æ‰¹æ¬¡èƒ½å¦åˆ†é…è®¢å•ï¼Œokï¼Œç°åœ¨æˆ‘ä»¬ä¸º<code>Batch</code>æ¨¡å‹æ·»åŠ æ–°çš„æ–¹æ³•</p><pre id="791164a1-81e5-4e60-9766-4a59abd53e8b" class="code"><code>def can_allocate(self, line: OrderLine) -&gt; bool:
    return self.sku == line.sku and self.available_quantity &gt;= line.qty</code></pre><p id="46e5c785-7676-4de3-a864-c9859a995fc8" class="">ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é€’å¢æˆ–é€’å‡<code>Batch.available_quantity</code>æ¥è§£é™¤åˆ†é…çš„åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬å®ç°<code>deallocate()</code>ï¼Œé¦–å…ˆæˆ‘ä»¬å…ˆå†™æµ‹è¯•</p><pre id="72516a8c-7950-4990-9a70-5e9546df52a0" class="code"><code>def test_can_only_deallocate_allocated_lines():
    batch, unallocated_line = make_batch_and_line(&quot;DECORATIVE-TRINKET&quot;, 20, 2)
    batch.deallocate(unallocated_line)
    assert batch.available_quantity == 20</code></pre><p id="63b17796-f448-4657-b762-555aa1818360" class="">åœ¨è¿™ä¸ªæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æ–­è¨€ä»ä¸€ä¸ªé‡‡è´­æ‰¹æ¬¡è§£ç»‘ä¸€ä¸ªè®¢å•æ²¡æœ‰æ•ˆæœï¼Œé™¤éè¯¥é‡‡è´­æ‰¹æ¬¡å…ˆå‰åˆ†é…äº†è¯¥è®¢å•ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å·²ç»åˆ†é…äº†é‚£äº›è®¢å•ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ç°</p><pre id="ed4ec76b-4d19-4fa1-8ee4-666db6ee5008" class="code"><code>class Batch:
    def __init__(
    self, ref: str, sku: str, qty: int, eta: Optional[date]
    ):
        self.reference = ref
        self.sku = sku
        self.eta = eta
        self._purchased_quantity = qty
        self._allocations = set() # type: Set[OrderLine]
        
    def allocate(self, line: OrderLine):
        if self.can_allocate(line):
            self._allocations.add(line)
            
    def deallocate(self, line: OrderLine):
        if line in self._allocations:
            self._allocations.remove(line)
        
    @property
    def allocated_quantity(self) -&gt; int:
        return sum(line.qty for line in self._allocations)
        
    @property
    def available_quantity(self) -&gt; int:
        return self._purchased_quantity - self.allocated_quantity
        
    def can_allocate(self, line: OrderLine) -&gt; bool:
        return self.sku == line.sku and self.available_quantity &gt;= line.qty
</code></pre><p id="895f168c-1298-4cd6-9932-bd53a4fa63e2" class="">ä¸€ä¸‹æ˜¯æˆ‘ä»¬UMLæ¨¡å‹å›¾</p><figure id="e18ec9d9-4ec2-4381-b4b9-3d44368ca49b" class="image"><a href="https://user-gold-cdn.xitu.io/2020/3/2/1709a5200ccd422e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><img src="https://user-gold-cdn.xitu.io/2020/3/2/1709a5200ccd422e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"/></a></figure><p id="a5f866b1-9573-468a-9fed-6c99d85c1736" class="">OK,é‡‡è´­æ‰¹æ¬¡ç°åœ¨å¯ä»¥è¿½è¸ªä¸€ç»„å·²ç»åˆ†é…çš„<code>OrderLine</code>å¯¹è±¡ã€‚å½“æˆ‘ä»¬åˆ†é…æ—¶ï¼Œå¦‚æœæˆ‘ä»¬æœ‰è¶³å¤Ÿçš„å¯ç”¨æ•°é‡ï¼Œæˆ‘ä»¬åªæ˜¯æ·»åŠ åˆ°é›†åˆä¸­ã€‚æˆ‘ä»¬ç°åœ¨çš„å¯ç”¨æ•°é‡æ˜¯ä¸€ä¸ª<code>property</code>çš„è®¡ç®—å±æ€§ï¼šè´­ä¹°æ•°é‡ - åˆ†é…æ•°é‡</p><p id="2d31181a-70cf-4e9f-bb75-95ab4dc02013" class="">emmmm, æˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šäº‹æƒ…è¦åšã€‚æ¯”å¦‚ <code>allocate()</code>å’Œ<code>deallocate()</code>æœ‰å¯èƒ½æ‚„æ— å£°æ¯çš„å¤±è´¥ï¼Œä½†æˆ‘ä»¬è‡³å°‘æœ‰äº†ä¸€ä¸ªåŸºç¡€æ¨¡å‹</p><p id="505b0d0b-a4b3-48a6-9577-d17530047919" class="">é¡ºä¾¿è¯´ä¸€å¥ï¼Œ<code>_allocations</code>æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªsetï¼Œä»–è®©æˆ‘ä»¬æˆ‘ä»¬å®¹æ˜“å¤„ç†æœ€åä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå› ä¸ºé›†åˆä¸­çš„é¡¹æ˜¯å”¯ä¸€çš„</p><pre id="d293868b-c137-467f-a3aa-b3b3b4e8299e" class="code"><code>def test_allocation_is_idempotent():
    batch, line = make_batch_and_line(&quot;ANGULAR-DESK&quot;, 20, 2)
    batch.allocate(line)
    batch.allocate(line)
    assert batch.available_quantity == 18</code></pre><p id="ec031477-4b01-4396-86ee-740d47080ef6" class="">OK,åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæœ‰å¾ˆå¤šäººè§‰å¾—é¢†åŸŸæ¨¡å‹è¿‡äºçç¢ï¼Œä¸å€¼å¾—å»è´¹å¿ƒDDDï¼ˆç”šè‡³æœ‰äººè¿é¢å‘å¯¹è±¡éƒ½ä¸å»åšï¼‰ã€‚å½“ç„¶è¿™ä¹Ÿä¸æ˜¯æ²¡æœ‰æ ¹æ®ï¼Œå› ä¸ºåœ¨ç°å®å¼€å‘ä¸­ï¼Œä»»ä½•æ•°é‡çš„ä¸šåŠ¡è§„åˆ™å’Œè¾¹ç¼˜æ¡ˆä¾‹éƒ½ä¼šå‡ºçªç„¶å‡ºç°ï¼Œæ¯•ç«Ÿäº§å“ç»ç†éƒ½æ˜¯ç¥ç»ç—…ã€‚æ¯”å¦‚ï¼šå®¢æˆ·è¦æ±‚åœ¨ç‰¹å®šçš„æœªæ¥æ—¥æœŸæ‹¿åˆ°è´§ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯èƒ½ä¸å¸Œæœ›å°†ä»–ä»¬åˆ†é…åˆ°æœ€æ—©çš„é‡‡è´­æ‰¹æ¬¡ä¸­ã€‚ä¸€äº›äº§å“å‘¢ï¼Œåˆä¸æ˜¯ä»é‡‡è´­è®¢å•é‚£é‡Œåˆ†é…çš„ï¼Œè€Œæ˜¯ç›´æ¥ä»ä¾›åº”å•†é‚£é‡Œè®¢è´­çš„ï¼Œæ‰€ä»¥ä»–ä»¬æœ‰ä¸åŒçš„é€»è¾‘ã€‚æ ¹æ®å®¢æˆ·çš„ä½ç½®ï¼Œæˆ‘ä»¬åˆ†é…åˆ°ä»–ä»¬æ‰€åœ¨åœ°åŒºçš„ä¸€éƒ¨åˆ†ä»“åº“å’Œè´§ç‰©ï¼Œè¿˜æœ‰ä¸€äº›æ¯”å¦‚æˆ‘ä»¬æœ¬åœ°åŒºç¼ºè´§çš„è¯ã€‚æˆ‘ä»¬ä¹æ„ä»ä¸åŒåœ°åŒºçš„ä»“åº“è¿é€è´§ç‰©ï¼Œç­‰ç­‰ï¼Œäº§å“ç»ç†æ€»ä¼šæ¯”æˆ‘ä»¬æƒ³è±¡ä¸­æ›´å¿«çš„é€Ÿåº¦å»å †ç§¯å¤æ‚æ€§ã€‚</p><p id="85fe06de-85a9-4d84-933a-d85d85bba855" class="">ä½†éšç€æˆ‘ä»¬æ–‡ç« çš„è¿›è¡Œï¼Œæˆ‘ä»¬å°†ç»§ç»­æ‹“å±•æˆ‘ä»¬è¿™ä¸ªç®€å•çš„æ¨¡å‹ï¼Œå¹¶å°†ä»–æ’å…¥åˆ°APIï¼Œæ•°æ®åº“ï¼Œç”šè‡³Excleä¸­ç­‰çœŸå®çš„ä¸šåŠ¡åœºæ™¯ä¸­ã€‚æˆ‘ä»¬å°†çœ‹åˆ°ä¸¥æ ¼éµå¾ªå°è£…å’Œä»”ç»†åˆ†å±‚çš„åŸåˆ™å°†å¦‚ä½•å¸®åŠ©æˆ‘ä»¬é¿å…å‡ºç°ä¸€å›¢å±å±±ã€‚</p><p id="582c8535-c1b6-4cfb-b4a7-dd0637c53f96" class="">
</p><h2 id="eb6efd5c-13b1-46b4-b08c-4f62df099a87" class="">Dataclasseså¯ä»¥è®©å¯¹å€¼å¯¹è±¡ï¼ˆValue Objectsï¼‰æ›´å…·æœ‰è¡¨è¾¾åŠ›</h2><p id="91f822cd-e84c-415b-bb3d-08f23d0c0f40" class="">åœ¨å‰é¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¤§é‡ä½¿ç”¨äº†<code>OrderLine</code>å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ª<code>line</code>ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåœ¨æˆ‘ä»¬è¿™ä¸ªä¸šåŠ¡ä¸­ï¼Œä¸€é¡¹è®¢å•å¯èƒ½å«æœ‰å¤šä¸ªè´§ç‰©åœ¨é‡Œé¢ï¼Œæ¯ä¸ª<code>line</code>ç”±ä¸€ä¸ªSKUå’Œæ•°é‡æ¥è¡¨è¾¾ï¼Œé‚£æˆ‘ä»¬è¿™æ ·çš„ä¸€ä¸ªè®¢å•ç”¨YAMLæ¥è¡¨ç¤ºï¼Œå¯èƒ½æ˜¯è¿™æ ·çš„</p><pre id="8c4be2e3-7d4d-4164-9d5c-8987950115ad" class="code"><code>Order_reference: 12345
Lines:
 - sku: RED-CHAIR
   qty: 25
 - sku: BLU-CHAIR
   qty: 25
 - sku: GRN-CHAIR
   qty: 25</code></pre><p id="7bfb2bbf-f116-41be-ac55-9afe49c6a765" class="">è¿™é‡Œä½ å¯èƒ½ä¼šå‘ç°ï¼Œè™½ç„¶æ¯ä¸ªè®¢å•éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†å®ƒçš„å¼•ç”¨ï¼Œä½†æ˜¯<code>OrderLine</code>ç¡®æ²¡æœ‰ã€‚æ‰€ä»¥å³ä½¿æˆ‘ä»¬å°†è®¢å•çš„å¼•ç”¨æ·»åŠ åˆ°<code>OrderLine</code>ç±»ä¸­ï¼Œä»–ä¹Ÿä¸æ˜¯æ ‡è¯†<code>OrderLine</code>æœ¬èº«ã€‚</p><p id="25487431-efa9-497a-9a89-45419eb4c4ed" class="">æ¯å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªæœ‰æ•°æ®ä½†æ˜¯æ²¡æœ‰èº«ä»½çš„ä¸šåŠ¡æ¦‚å¿µæ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç”¨Value Objectå»è¡¨è¾¾å®ƒã€‚Value Objectæ˜¯æŒæœ‰é¢†åŸŸå¯¹è±¡å”¯ä¸€æ ‡è¯†æ•°æ®çš„å¯¹è±¡ã€‚æˆ‘ä»¬é€šå¸¸ä½¿å¥¹ä¸èƒ½æ”¹å˜ã€‚å¯å˜æ•°æ®æ˜¯è®©ç³»ç»Ÿå˜å¾—å¤æ‚çš„ç½ªé­ç¥¸é¦–ã€‚</p><p id="d1583d37-5a76-46e1-9aef-8e8042e14f7a" class="">dataclassesç»™æˆ‘ä»¬ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå…·æœ‰ç›¸åŒçš„<code>order_id</code>/<code>sku</code>/<code>qty</code>çš„ä¸¤ä¸ªæ•°æ®ä»–ä»¬æ˜¯ç›¸ç­‰çš„ã€‚æ¯”å¦‚</p><pre id="641a064d-1e8d-4ef7-94b9-fa31a0754b59" class="code"><code>from dataclasses import dataclass
from typing import NamedTuple
from collections import namedtuple

@dataclass(frozen=True)
class Name:
    first_name: str
    surname: str
    
class Money(NamedTuple):
    currency: str
    value: int
    
Line = namedtuple(&#x27;Line&#x27;, [&#x27;sku&#x27;, &#x27;qty&#x27;])

def test_equality():
    assert Money(&#x27;gbp&#x27;, 10) == Money(&#x27;gbp&#x27;, 10)
    assert Name(&#x27;Harry&#x27;, &#x27;Percival&#x27;) != Name(&#x27;Bob&#x27;, &#x27;Gregory&#x27;)
    assert Line(&#x27;RED-CHAIR&#x27;, 5) == Line(&#x27;RED-CHAIR&#x27;, 5)</code></pre><p id="baafce46-2a54-4a23-b5d7-ce2222beaf52" class="">è¿™äº›<code>Value Object</code>ç¬¦åˆæˆ‘ä»¬å¯¹ç°å®ä¸–ç•Œä¸­çš„ç›´è§‰ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬è®¨è®ºç©¶ç«Ÿæ˜¯å“ªå¼ 100å…ƒäººæ°‘å¸é’ç¥¨å¯¹æˆ‘ä»¬æ¥è¯´å¹¶ä¸é‡è¦ï¼Œå› ä¸ºä»–ä»¬éƒ½æœ‰ç›¸åŒçš„ä»·å€¼ã€‚åŒæ ·å¦‚æœä¸¤ä¸ª<code>OrderLine</code>å…·æœ‰ç›¸åŒçš„order_id ã€qtyã€skuã€‚é‚£ä¹ˆä»–ä»¬ä¸¤ä¸ªä¹Ÿæ˜¯ç›¸ç­‰çš„ã€‚é™¤äº†è¿™äº›ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥è¿›è¡Œæ›´å¤šçš„æ›´å¤æ‚çš„æ“ä½œã€‚ä¾‹å¦‚ä¸€äº›æ•°å­¦æ“ä½œç¬¦</p><pre id="6bfab418-522e-48ff-846c-c8473434bef8" class="code"><code>fiver = Money(&#x27;gbp&#x27;, 5)
tenner = Money(&#x27;gbp&#x27;, 10)
def can_add_money_values_for_the_same_currency():
    assert fiver + fiver == tenner
    
def can_subtract_money_values():
    assert tenner - fiver == fiver
 
def adding_different_currencies_fails():
    with pytest.raises(ValueError):
        Money(&#x27;usd&#x27;, 10) + Money(&#x27;gbp&#x27;, 10)
 
def can_multiply_money_by_a_number():
    assert fiver * 5 == Money(&#x27;gbp&#x27;, 25)
    
def multiplying_two_money_values_is_an_error():
    with pytest.raises(TypeError):
        tenner * fiver</code></pre><p id="5c3d9c17-e345-4acd-b08e-95f801b66809" class="">
</p><h2 id="0ff25590-6aa3-4d91-becb-35091882afd5" class="">Dataclasseså¯ä»¥è®©å¯¹å€¼å¯¹è±¡ï¼ˆValue Objectsï¼‰æ›´å…·æœ‰è¡¨è¾¾åŠ›</h2><p id="79be554e-7815-46f6-8d56-c05dbca5556b" class="">åœ¨å‰é¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¤§é‡ä½¿ç”¨äº†<code>OrderLine</code>å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ª<code>line</code>ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåœ¨æˆ‘ä»¬è¿™ä¸ªä¸šåŠ¡ä¸­ï¼Œä¸€é¡¹è®¢å•å¯èƒ½å«æœ‰å¤šä¸ªè´§ç‰©åœ¨é‡Œé¢ï¼Œæ¯ä¸ª<code>line</code>ç”±ä¸€ä¸ªSKUå’Œæ•°é‡æ¥è¡¨è¾¾ï¼Œé‚£æˆ‘ä»¬è¿™æ ·çš„ä¸€ä¸ªè®¢å•ç”¨YAMLæ¥è¡¨ç¤ºï¼Œå¯èƒ½æ˜¯è¿™æ ·çš„</p><pre id="786ec317-c97f-4df8-8982-b99e37d68869" class="code"><code>Order_reference: 12345
Lines:
 - sku: RED-CHAIR
   qty: 25
 - sku: BLU-CHAIR
   qty: 25
 - sku: GRN-CHAIR
   qty: 25</code></pre><p id="06f4d06a-0bd8-4de3-9ae2-5e3b58dff296" class="">è¿™é‡Œä½ å¯èƒ½ä¼šå‘ç°ï¼Œè™½ç„¶æ¯ä¸ªè®¢å•éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€æ ‡è¯†å®ƒçš„å¼•ç”¨ï¼Œä½†æ˜¯<code>OrderLine</code>ç¡®æ²¡æœ‰ã€‚æ‰€ä»¥å³ä½¿æˆ‘ä»¬å°†è®¢å•çš„å¼•ç”¨æ·»åŠ åˆ°<code>OrderLine</code>ç±»ä¸­ï¼Œä»–ä¹Ÿä¸æ˜¯æ ‡è¯†<code>OrderLine</code>æœ¬èº«ã€‚</p><p id="c298db73-8925-447f-a0c9-76861bc97a6f" class="">æ¯å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªæœ‰æ•°æ®ä½†æ˜¯æ²¡æœ‰èº«ä»½çš„ä¸šåŠ¡æ¦‚å¿µæ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç”¨Value Objectå»è¡¨è¾¾å®ƒã€‚Value Objectæ˜¯æŒæœ‰é¢†åŸŸå¯¹è±¡å”¯ä¸€æ ‡è¯†æ•°æ®çš„å¯¹è±¡ã€‚æˆ‘ä»¬é€šå¸¸ä½¿å¥¹ä¸èƒ½æ”¹å˜ã€‚å¯å˜æ•°æ®æ˜¯è®©ç³»ç»Ÿå˜å¾—å¤æ‚çš„ç½ªé­ç¥¸é¦–ã€‚</p><p id="52e3d135-6dfb-4fb6-a709-b309b8e8f7f2" class="">dataclassesç»™æˆ‘ä»¬ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå…·æœ‰ç›¸åŒçš„<code>order_id</code>/<code>sku</code>/<code>qty</code>çš„ä¸¤ä¸ªæ•°æ®ä»–ä»¬æ˜¯ç›¸ç­‰çš„ã€‚æ¯”å¦‚</p><pre id="1a7bc0ae-e53e-43f2-a3a4-9c2eb4c333bb" class="code"><code>from dataclasses import dataclass
from typing import NamedTuple
from collections import namedtuple

@dataclass(frozen=True)
class Name:
    first_name: str
    surname: str
    
class Money(NamedTuple):
    currency: str
    value: int
    
Line = namedtuple(&#x27;Line&#x27;, [&#x27;sku&#x27;, &#x27;qty&#x27;])

def test_equality():
    assert Money(&#x27;gbp&#x27;, 10) == Money(&#x27;gbp&#x27;, 10)
    assert Name(&#x27;Harry&#x27;, &#x27;Percival&#x27;) != Name(&#x27;Bob&#x27;, &#x27;Gregory&#x27;)
    assert Line(&#x27;RED-CHAIR&#x27;, 5) == Line(&#x27;RED-CHAIR&#x27;, 5)</code></pre><p id="b784f744-bba7-4ba3-bfec-bf1e90babac8" class="">è¿™äº›<code>Value Object</code>ç¬¦åˆæˆ‘ä»¬å¯¹ç°å®ä¸–ç•Œä¸­çš„ç›´è§‰ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬è®¨è®ºç©¶ç«Ÿæ˜¯å“ªå¼ 100å…ƒäººæ°‘å¸é’ç¥¨å¯¹æˆ‘ä»¬æ¥è¯´å¹¶ä¸é‡è¦ï¼Œå› ä¸ºä»–ä»¬éƒ½æœ‰ç›¸åŒçš„ä»·å€¼ã€‚åŒæ ·å¦‚æœä¸¤ä¸ª<code>OrderLine</code>å…·æœ‰ç›¸åŒçš„order_id ã€qtyã€skuã€‚é‚£ä¹ˆä»–ä»¬ä¸¤ä¸ªä¹Ÿæ˜¯ç›¸ç­‰çš„ã€‚é™¤äº†è¿™äº›ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥è¿›è¡Œæ›´å¤šçš„æ›´å¤æ‚çš„æ“ä½œã€‚ä¾‹å¦‚ä¸€äº›æ•°å­¦æ“ä½œç¬¦</p><pre id="2663785c-3a91-44da-ada6-a3f3e89de319" class="code"><code>fiver = Money(&#x27;gbp&#x27;, 5)
tenner = Money(&#x27;gbp&#x27;, 10)
def can_add_money_values_for_the_same_currency():
    assert fiver + fiver == tenner
    
def can_subtract_money_values():
    assert tenner - fiver == fiver
 
def adding_different_currencies_fails():
    with pytest.raises(ValueError):
        Money(&#x27;usd&#x27;, 10) + Money(&#x27;gbp&#x27;, 10)
 
def can_multiply_money_by_a_number():
    assert fiver * 5 == Money(&#x27;gbp&#x27;, 25)
    
def multiplying_two_money_values_is_an_error():
    with pytest.raises(TypeError):
        tenner * fiver</code></pre><h2 id="75574c6c-cb74-4327-8a29-ad4fc5c4197d" class="">Value Objects å’Œ Entities(å®ä½“)</h2><p id="b3f267ca-1f50-4bdd-8ee7-5f5126305b96" class="">é¦–å…ˆæˆ‘ä»¬çœ‹<code>OrderLine</code>ç”±<code>order_id</code>ã€<code>sku</code>ã€<code>qty</code>ç»„æˆï¼Œå¦‚æœæˆ‘ä»¬æ›´æ”¹å…¶ä¸­ä»»æ„ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆç°åœ¨å…¶å®åº”è¯¥æ˜¯æœ‰ä¸€ä¸ªæ–°çš„<code>OrderLine</code>ã€‚è¿™å°±æ˜¯<code>Value Object</code>çš„å®šä¹‰ï¼šä»»ä½•ç”±å…¶æ•°æ®æ ‡è¯†çš„å¯¹è±¡ï¼Œå¹¶ä¸”æ²¡æœ‰é•¿æœŸå­˜åœ¨çš„æ ‡å¿—ã€‚é‚£ä¹ˆEntitieså‘¢ï¼Ÿ</p><p id="91b72505-4df1-4b30-b092-391f127d8035" class="">æ˜¯å¦è¿˜æ˜¯æœ‰ç‚¹æ„Ÿåˆ°å¤´æ™•ï¼Ÿé‚£ä¹ˆæˆ‘ä»¬çœ‹ä¸ªç®€å•çš„ä¾‹å­ï¼Œä¸Šæ–‡ä¸­æˆ‘ä»¬å®šä¹‰äº†ä¸ªå«<code>Name</code>çš„Value Objectã€‚å¦‚æœæˆ‘ä»¬å–åå«å¼ ä¸‰ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬æ¢ä¸€ä¸ªåå­—ï¼Œå«â€œæå››â€é‚£ä¹ˆâ€œå¼ ä¸‰â€è¿˜æ˜¯â€œå¼ ä¸‰â€å—ï¼Ÿä¸ï¼Œä½ åº”è¯¥æ˜¯è·å¾—äº†å«æå››çš„<code>Name</code>å¯¹è±¡</p><pre id="d040ab9a-eb10-4f85-96ca-21e1c3c0611a" class="code"><code>def test_name_equality():
    assert Name(&quot;å¼ ä¸‰&quot;) != Name(&quot;æå››&quot;)</code></pre><p id="49b44510-8ce2-423f-a432-87d909b97b2a" class="">ä½†æ˜¯ä½œä¸ºä¸€ä¸ªäººå‘¢ï¼Ÿå¼ ä¸‰å‘¢ï¼Ÿäººç¡®å®å¯ä»¥æ”¹å˜ä»–ä»¬çš„åå­—ï¼Œå©šå§»çŠ¶å†µï¼Œç”šè‡³å¯èƒ½æ€§åˆ«ä¹Ÿå¯ä»¥æ”¹å˜ã€‚ä½†æ˜¯å¼ ä¸‰å»æ³°å›½åšäº†æ‰‹æœ¯ï¼Œé‚£å¼ ä¸‰è¿˜æ˜¯å¼ ä¸‰å—ï¼Ÿå¯¹ï¼Œå¼ ä¸‰è¿˜æ˜¯å¼ ä¸‰ã€‚è¿™æ˜¯å› ä¸ºäººä¸åå­—ä¸åŒã€‚äººæœ‰ä¸€ä¸ªæŒä¹…çš„èº«ä»½ã€‚</p><pre id="71e47570-6004-46a1-896d-7dac255d8c55" class="code"><code>class Person:
    def __init__(self, name: Name):
        self.name = name
        
def test_barry_is_harry():
    harry = Person(Name(&quot;å¼ ä¸‰&quot;))
    barry = harry
    barry.name = Name(&quot;æå››&quot;)
    assert harry is barry and barry is harr</code></pre><p id="a8724417-6d25-4313-89db-eadfded1fc0d" class="">å®ä½“ï¼ˆEntitiesï¼‰ä¸æ˜¯å€¼ï¼ŒÂ å…·æœ‰ç›¸åŒçš„èº«ä»½ã€‚æˆ‘ä»¬å¯ä»¥æ”¹å˜ä»–ä»¬çš„å€¼ã€‚ä½†æ˜¯ä»–ä»¬ä»ç„¶æ˜¯ä¸€æ ·çš„ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ã€‚<code>Batch</code>å°±æ˜¯å®ä½“ã€‚æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ª<code>OrderLine</code>åˆ†é…ç»™ä¸€ä¸ªBatchã€‚</p><p id="74b0e0de-dcce-4f14-9dff-5e5bd110ca2b" class="">æˆ–è€…æˆ‘ä»¬æ›´æ”¹ä»–çš„ETAÂ ï¼Œä½†æ˜¯ä»–ä»¬ä»ä»»ç›¸åŒã€‚</p><p id="a99184cb-53bb-4f19-926d-dff924605dbd" class="">å½“ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹<code>Batch</code>çš„é­”æœ¯æ–¹æ³•æ¥å®ç°ç”¨æ•°å­¦æ“ä½œç¬¦æ¥æ›´å¥½è¡¨è¾¾è¿™ä»¶äº‹æƒ…</p><pre id="307d5b4a-9f27-4f46-902a-1020e16d8460" class="code"><code>class Batch:
 ...
    def __eq__(self, other):
        if not isinstance(other, Batch):
            return False
        return other.reference == self.reference
 def __hash__(self):
    return hash(self.reference)</code></pre><h2 id="f3a86717-245f-48c1-bc13-1c49d3b1665e" class="">ä¸æ˜¯æ‰€æœ‰ä¸œè¥¿éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡</h2><p id="3c84c05b-2244-4feb-b252-7fbdd339edcf" class="">æˆ‘ä»¬åˆšåˆšå·²ç»å»ºç«‹äº†ä¸€ä¸ªé‡‡è´­æ‰¹æ¬¡çš„æ¨¡å‹ï¼Œä½†å®é™…ä¸Šæˆ‘è¿˜è¿˜éœ€è¦åšçš„æ˜¯é’ˆå¯¹æˆ‘ä»¬å·²ç»åœ¨åº“å­˜çš„é‡‡è´­æ‰¹æ¬¡æ¥åˆ†é…è®¢å•ã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯èƒ½ä¸æ˜¯éœ€è¦ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œæ˜¯éœ€è¦ä¸€ä¸ªé¢†åŸŸæœåŠ¡(domin function)ï¼Œé‚£ä¹ˆä»€ä¹ˆå«é¢†åŸŸæœåŠ¡å‘¢ï¼ŸEvansåœ¨DDDè®¨è®ºè¿‡è¿™ä¸ªï¼Œå³ï¼šé¢†åŸŸæœåŠ¡åœ¨å®ä½“æˆ–å€¼å¯¹è±¡ä¸­æ²¡æœ‰è‡ªç„¶çš„å½’å±ã€‚ç°åœ¨æ¥çœ‹æˆ‘ä»¬çš„éœ€æ±‚ï¼Œç»™ä¸€ç»„é‡‡è´­æ‰¹æ¬¡åˆ†é…è®¢å•ã€‚è¿™ä¸ªäº‹æƒ…å¬èµ·æ¥å…¶å®æ˜¯ä¸ªå‡½æ•°ã€‚é‚£æˆ‘ä»¬å°±æŠŠä»–å˜æˆä¸€ä¸ªå‡½æ•°ã€‚é¦–å…ˆæˆ‘ä»¬å…ˆçœ‹çœ‹å¦‚ä½•æµ‹è¯•è¿™ä¸ªå‡½æ•°</p><pre id="af4b8c08-935a-4b46-8200-85882fa5cef1" class="code"><code>def test_prefers_current_stock_batches_to_shipments():
    in_stock_batch = Batch(&quot;in-stock-batch&quot;, &quot;RETRO-CLOCK&quot;, 100, eta=None)
    shipment_batch = Batch(&quot;shipment-batch&quot;, &quot;RETRO-CLOCK&quot;, 100, eta=tomorrow)
    line = OrderLine(&quot;oref&quot;, &quot;RETRO-CLOCK&quot;, 10)
    allocate(line, [in_stock_batch, shipment_batch])
    assert in_stock_batch.available_quantity == 90
    assert shipment_batch.available_quantity == 100
 
def test_prefers_earlier_batches():
    earliest = Batch(&quot;speedy-batch&quot;, &quot;MINIMALIST-SPOON&quot;, 100, eta=today)
    medium = Batch(&quot;normal-batch&quot;, &quot;MINIMALIST-SPOON&quot;, 100, eta=tomorrow)
    latest = Batch(&quot;slow-batch&quot;, &quot;MINIMALIST-SPOON&quot;, 100, eta=later)
    line = OrderLine(&quot;order1&quot;, &quot;MINIMALIST-SPOON&quot;, 10)
    allocate(line, [medium, earliest, latest])
    assert earliest.available_quantity == 90
    assert medium.available_quantity == 100
    assert latest.available_quantity == 100
    
def test_returns_allocated_batch_ref():
    in_stock_batch = Batch(&quot;in-stock-batch-ref&quot;, &quot;HIGHBROW-POSTER&quot;, 100, eta=None)
    shipment_batch = Batch(&quot;shipment-batch-ref&quot;, &quot;HIGHBROW-POSTER&quot;, 100, eta=tomorrow)
    line = OrderLine(&quot;oref&quot;, &quot;HIGHBROW-POSTER&quot;, 10)
    allocation = allocate(line, [in_stock_batch, shipment_batch])
    assert allocation == in_stock_batch.reference</code></pre><p id="c43438ac-15ab-4538-b8f9-dfe60a2ccee4" class="">æˆ‘ä»¬çš„æœåŠ¡å‡½æ•°åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><pre id="2baf6931-7547-412f-9d41-e9d1e2f9dc53" class="code"><code>def allocate(line: OrderLine, batches: List[Batch]) -&gt; str:
    batch = next(
    b for b in sorted(batches) if b.can_allocate(line)
    )
    batch.allocate(line)
    return batch.reference</code></pre><p id="1ee694e7-7ce1-40a2-99a7-62c504b052c1" class="">æˆ‘ä»¬ä¸ºäº†èƒ½å¤Ÿä½¿sortedå·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦é‡å†™æˆ‘ä»¬<code>Batch</code>æ¨¡å‹çš„<code>_gt_</code>é­”æ³•æ–¹æ³•</p><pre id="ddf32dee-5b92-450b-8d2e-302cd10206a5" class="code"><code>class Batch:
 ...
 def __gt__(self, other):
    if self.eta is None:
        return False
    if other.eta is None:
        return True
    return self.eta &gt; other.eta</code></pre><p id="1576a122-1035-4d31-bab1-04da932e3104" class="">è¿™æ ·çœ‹èµ·æ¥å°±ä¼˜é›…å¤šäº†</p><h2 id="5d813264-18fb-4930-989c-ef2acb03102b" class="">å¼‚å¸¸ä¹Ÿèƒ½ç”¨æ¥é¢†åŸŸæ¦‚å¿µ</h2><p id="64b789fe-47b0-4ea0-8e1e-edebfe0e3bff" class="">ç°åœ¨æˆ‘ä»¬è¿˜å‰©ä¸‹æœ€åä¸€ä¸ªæ¦‚å¿µè¦å°†ï¼šå¼‚å¸¸ä¹Ÿå¯ä»¥ç”¨æ¥è¡¨è¾¾é¢†åŸŸæ¦‚å¿µã€‚æˆ‘ä»¬åœ¨ä¸äº§å“ç»ç†çš„æ²Ÿé€šä¸­äº†è§£åˆ°ï¼Œç”±äºç¼ºè´§è€Œæ— æ³•åˆ†é…è®¢å•çš„å¯èƒ½æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é¢†åŸŸå¼‚å¸¸æ¥æ•è·è¿™ç§å¯èƒ½æ€§ã€‚æˆ‘ä»¬å…ˆå†™æµ‹è¯•</p><pre id="b8d237a9-4759-40ab-a48e-a9a5e481f739" class="code"><code>def test_raises_out_of_stock_exception_if_cannot_allocate():
    batch = Batch(&#x27;batch1&#x27;, &#x27;SMALL-FORK&#x27;, 10, eta=today)
    allocate(OrderLine(&#x27;order1&#x27;, &#x27;SMALL-FORK&#x27;, 10), [batch])
    with pytest.raises(OutOfStock, match=&#x27;SMALL-FORK&#x27;):
        allocate(OrderLine(&#x27;order2&#x27;, &#x27;SMALL-FORK&#x27;, 1), [batch])</code></pre><p id="f4f0f060-ad86-46f9-b61e-6fe54ba56c15" class="">è¿™é‡Œæˆ‘ä»¬å¿…é¡»è¦æä¸ªé†’ï¼Œæˆ‘ä»¬åœ¨ç”¨è¯­è¨€å‘½åæˆ‘ä»¬å¼‚å¸¸æ—¶è¦éå¸¸è°¨æ…ï¼Œå°±åƒæˆ‘ä»¬å‘½åæˆ‘ä»¬å®ä½“å€¼å¯¹è±¡å’Œæˆ‘ä»¬é¢†åŸŸæœåŠ¡ä¸€æ ·ã€‚</p><pre id="66b772d5-4a00-468a-acee-b5a7a6ca25ea" class="code"><code>class OutOfStock(Exception):
    pass
    
def allocate(line: OrderLine, batches: List[Batch]) -&gt; str:
    try:
        batch = next(
        ...ï¼‰
    except StopIteration:
        raise OutOfStock(f&#x27;Out of stock for sku {line.sku}&#x27;)</code></pre><h2 id="19fff78e-b7d5-410b-b793-9679747a19a2" class="">ç»“è¯­</h2><p id="0e90e8e8-597c-4d31-8252-a7f33e4e442f" class="">OKï¼Œç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥èƒ½å¤Ÿå¯¹æˆ‘ä»¬å‰æ–‡å½“ä¸­çš„æ¨¡å‹å›¾ä¾‹è¿›è¡Œä¸€ä¸ªå®Œæ•´çš„æ¦‚å¿µè¡¨ç¤ºäº†</p><figure id="30755777-0033-4f11-8f49-7219d7cb94d2" class="image"><a href="https://user-gold-cdn.xitu.io/2020/3/2/1709a51fa99d16d1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"><img src="https://user-gold-cdn.xitu.io/2020/3/2/1709a51fa99d16d1?imageView2/0/w/1280/h/960/format/webp/ignore-error/1"/></a></figure><p id="c80ac313-0d60-4344-b1f9-151db0ff5f14" class="">ç°åœ¨å¤§æ¦‚å¯ä»¥äº†æˆ‘ä»¬å…¶å®å°±å·®ä¸€ä¸ªæ•°æ®åº“äº†ã€‚</p><p id="4ba9e2c7-6829-4521-a7e3-4f17a931fd96" class="">æˆ‘ä»¬å¯¹æœ¬ç« åšä¸€ä¸ªæ€»ç»“</p><ol id="506eda29-f616-42b2-bd4c-512b0deb76d8" class="numbered-list" start="1"><li>é¢†åŸŸå»ºæ¨¡<p id="79379943-fdc6-4725-9c96-ab2de85f6b76" class="">è¿™æ˜¯æˆ‘ä»¬ä»£ç ä¸­æœ€æ¥è¿‘ä¸šåŠ¡ï¼Œæœ€æœ‰å¯èƒ½æ›´æ”¹çš„éƒ¨åˆ†ã€‚ä¹Ÿæ˜¯æˆ‘ä»¬äº¤ä»˜ä¸­æœ€æœ‰ä»·å€¼çš„éƒ¨åˆ†ã€‚æ‰€ä»¥æˆ‘ä»¬è¦è®©å®ƒæ˜“äºç†è§£å’Œä¿®æ”¹</p></li></ol><ol id="01f3c480-1c71-4c36-b3f0-2869ffe177f2" class="numbered-list" start="2"><li>åŒºåˆ†å®ä½“å’Œå€¼å¯¹è±¡<p id="44c0295e-9c24-4797-be45-01d23de57db4" class="">å€¼å¯¹è±¡ç”±å…¶å±æ€§å®šä¹‰çš„ã€‚ä»–æœ€å¥½ä½œä¸ºä¸å¯å˜ç±»å‹ã€‚å¦‚æœä½ æ›´æ”¹äº†å€¼å¯¹è±¡ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œé‚£å®ƒè¡¨ç¤ºçš„å¯èƒ½æ˜¯ä¸€ä¸ªä¸åŒçš„å¯¹è±¡ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œä¸€ä¸ªå®ä½“çš„å±æ€§å¯ä»¥éšç€æ—¶é—´è€Œå˜åŒ–ã€‚ä½†ä»ç„¶æ˜¯åŒä¸€ä¸ªå®ä½“ã€‚å®šä¹‰å”¯ä¸€æ ‡è¯†å®ä½“çš„å†…å®¹éå¸¸é‡è¦</p></li></ol><ol id="3e42d375-beb8-465e-b4a4-86f543e20ba7" class="numbered-list" start="3"><li>ä¸æ˜¯æ‰€æœ‰ä¸œè¥¿éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡<p id="169e8b0c-9dbd-489c-b727-56fcbd1f6ed9" class="">æœ‰äº›æ—¶å€™ï¼Œä»–å¯èƒ½å°±ä¸æ˜¯ä¸ªäº‹æƒ…</p></li></ol><ol id="2acca603-02f4-4064-a6b1-1385bf8f44e0" class="numbered-list" start="4"><li>ç°åœ¨æ˜¯ä½ ç”¨åˆ°å„ç§OOè®¾è®¡æ¨¡å¼æœ€å¥½çš„æ—¶å€™<p id="4825981e-1bed-4883-b221-24bd6c2d14b0" class="">é‡æ–°å®¡è§†ä»¥ä¸‹é¢å‘å¯¹è±¡çš„å…­å¤§åŸºæœ¬åŸåˆ™ï¼Œæ¯”å¦‚ç»„åˆå¤§äºç»§æ‰¿ç­‰ã€‚</p></li></ol><ol id="48fcaab3-1b4a-45d9-bba8-e175121ba234" class="numbered-list" start="5"><li>ä½ è¿˜éœ€è¦è€ƒè™‘å†™è¾¹ç•Œæ¡ä»¶ç­‰ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢å†è®²ã€‚</li></ol><p id="bcfa78a7-cb49-416a-a4b3-59464c6bc2c6" class="">
</p><p id="8106fd18-bf24-435e-a037-e27e7dbf622a" class="">
</p></div></article></body></html>